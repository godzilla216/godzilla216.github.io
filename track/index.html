<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>100m Dash Racing Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .race-track {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }
        .lane {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #eee;
            position: relative;
        }
        .lane.highlight {
            background-color: yellow;
        }
        .runner {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: red;
            position: absolute;
            transition: transform 0.1s;
        }
        .start-button, .speed-up-button, .slow-down-button {
            display: block;
            width: 100%;
            max-width: 200px;
            margin: 10px auto;
            padding: 10px;
            background-color: #28a745;
            color: white;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
        }
        .slow-down-button {
            background-color: #007bff;
        }
        .stamina-bar {
            height: 10px;
            background-color: #28a745;
            width: 100%;
            margin-top: 10px;
        }
        .player-interface {
            margin-top: 20px;
            text-align: center;
        }
        .stars {
            margin-top: 10px;
            font-size: 24px;
        }
        .schedule, .divisions {
            text-align: center;
            margin: 20px 0;
        }
        .timer, .position, .average-placing, .bank-balance, .seasons-remaining {
            font-size: 20px;
            margin-top: 10px;
        }
        .finish-line {
            position: absolute;
            top: 0;
            left: 100%;
            height: 100%;
            width: 5px;
            background-color: red;
            z-index: 10;
        }
    </style>
</head>
<body>
    <div class="race-track">
        <!-- Finish line -->
        <div class="finish-line"></div>

        <!-- 8 lanes for runners -->
        <div class="lane highlight" id="lane1"><div class="runner" id="runner1"></div></div>
        <div class="lane" id="lane2"><div class="runner" id="runner2"></div></div>
        <div class="lane" id="lane3"><div class="runner" id="runner3"></div></div>
        <div class="lane" id="lane4"><div class="runner" id="runner4"></div></div>
        <div class="lane" id="lane5"><div class="runner" id="runner5"></div></div>
        <div class="lane" id="lane6"><div class="runner" id="runner6"></div></div>
        <div class="lane" id="lane7"><div class="runner" id="runner7"></div></div>
        <div class="lane" id="lane8"><div class="runner" id="runner8"></div></div>
    </div>

    <!-- Start, Speed Up, and Slow Down buttons -->
    <div class="start-button" onclick="startRace()">Start Race</div>
    <div class="speed-up-button" onmousedown="increaseSpeed()" onmouseup="resetSpeed()">Speed Up</div>
    <div class="slow-down-button" onmousedown="decreaseSpeed()" onmouseup="resetSpeed()">Slow Down</div>

    <!-- Player Interface -->
    <div class="player-interface">
        <div>Stamina</div>
        <div class="stamina-bar" id="stamina-bar"></div>
        <div class="stars" id="stars">⭐⭐</div>
        <div class="timer" id="timer">Time: 0.0s</div>
        <div class="position" id="position">Current Position: 1st</div>
        <div class="average-placing" id="average-placing">Average Placing: 1st</div>
        <div class="bank-balance" id="bank-balance">Bank Balance: Ineligible</div>
        <div class="seasons-remaining" id="seasons-remaining">Seasons Remaining: 5</div>
    </div>

    <!-- Schedule and Divisions -->
    <div class="schedule" id="schedule">Schedule: Race 1</div>
    <div class="divisions" id="division">Division: High School</div>

    <script>
        const runners = [];
        let interval, timerInterval;
        const playerLane = 1;
        const totalDistance = 100;
        let playerStamina = 100;
        let playerSpeed = 1;
        let speedMultiplier = 1;
        let wins = 0;
        let totalRaces = 0;
        let currentTime = 0.0;
        const racesPerDivision = 12;
        const seasonsPerDivision = 5;
        let currentSeason = 1;
        let seasonsRemaining = seasonsPerDivision;
        let currentDivision = "High School";
        const divisions = ["High School", "D1", "D2", "D3"];
        const maxStars = 5;
        let currentStars = 2;
        let totalPlacing = 0;
        let bankBalance = 0;
        let runnersSpeeds = [];

        for (let i = 1; i <= 8; i++) {
            runners.push({ id: i, distance: 0, speed: Math.random() * 0.5 + 1, finished: false });
        }

        function startRace() {
            clearInterval(interval);
            clearInterval(timerInterval);
            runners.forEach(runner => {
                runner.distance = 0;
                runner.finished = false;
                document.getElementById(`runner${runner.id}`).style.transform = `translateX(0px)`;
            });
            playerStamina = 100;
            currentTime = 0.0;
            speedMultiplier = 1;
            updateStaminaBar();
            updateTimer();
            updatePosition();
            updateAveragePlacing();
            updateBankBalance();
            adjustRunnerSpeeds();
            timerInterval = setInterval(updateTimer, 100);
            interval = setInterval(runRace, 100);
        }

        function adjustRunnerSpeeds() {
            runners.forEach(runner => {
                runner.speed = Math.random() * 0.5 + 1; // Random speed between 1 and 1.5
            });
        }

        function runRace() {
            runners.forEach(runner => {
                if (runner.distance < totalDistance && !runner.finished) {
                    let staminaFactor = runner.id === playerLane ? 0.5 + (playerStamina / 200) : 1;
                    runner.distance += runner.speed * staminaFactor * (runner.id === playerLane ? speedMultiplier : 1);
                    if (runner.distance >= totalDistance) {
                        runner.distance = totalDistance;
                        runner.finished = true;
                    }
                    document.getElementById(`runner${runner.id}`).style.transform = `translateX(${runner.distance * 8}px)`;
                    if (runner.id === playerLane) {
                        playerStamina = Math.max(0, playerStamina - (1 * speedMultiplier));
                        updateStaminaBar();
                    }
                }
            });

            updatePosition();

            if (runners.every(runner => runner.finished)) {
                clearInterval(interval);
                clearInterval(timerInterval);
                calculateResults();
            }
        }

        function increaseSpeed() {
            speedMultiplier = 1.5; // Increase speed by 50%
        }

        function decreaseSpeed() {
            speedMultiplier = 0.5; // Decrease speed by 50%
        }

        function resetSpeed() {
            speedMultiplier = 1; // Reset speed to normal
        }

        function updateStaminaBar() {
            document.getElementById('stamina-bar').style.width = `${playerStamina}%`;
        }

        function updateTimer() {
            currentTime += 0.1;
            document.getElementById('timer').textContent = `Time: ${currentTime.toFixed(1)}s`;
        }

        function updatePosition() {
            runners.sort((a, b) => b.distance - a.distance);
            const playerPosition = runners.findIndex(runner => runner.id === playerLane) + 1;
            document.getElementById('position').textContent = `Current Position: ${ordinal(playerPosition)}`;
        }

        function ordinal(n) {
            return n + (["st", "nd", "rd"][((n + 90) % 100 - 10) % 10 - 1] || "th");
        }

        function calculateResults() {
            const playerPosition = runners.findIndex(runner => runner.id === playerLane) + 1;
            totalRaces++;
            totalPlacing += playerPosition;
            if (playerPosition === 1) {
                bankBalance += 1000;
            } else if (playerPosition === 2) {
                bankBalance += 500;
            } else if (playerPosition === 3) {
                bankBalance += 250;
            }
            if (playerPosition === 1) wins++;
            updateStarSystem(playerPosition);
            checkDivision();
            updateAveragePlacing();
            updateBankBalance();
        }

        function updateStarSystem(position) {
            const avgPosition = totalPlacing / totalRaces;
            currentStars = Math.min(maxStars, Math.max(1, Math.ceil((5 - avgPosition / 2))));
            document.getElementById('stars').textContent = '⭐'.repeat(currentStars);
            playerSpeed = 1 + (currentStars - 2) * 0.2; // Adjust player speed based on stars
        }

        function checkDivision() {
            if (currentDivision === "High School" && totalRaces % racesPerDivision === 0) {
                // Reset average placing when moving from high school
                totalPlacing = 0;
                currentSeason = 1;
                seasonsRemaining = seasonsPerDivision;
                const nextDivision = determineNextDivision();
                currentDivision = nextDivision;
                document.getElementById('division').textContent = `Division: ${currentDivision}`;
                document.getElementById('bank-balance').textContent = `Bank Balance: Ineligible`;
            } else if (totalRaces % racesPerDivision === 0) {
                // Move to the next division
                const nextDivisionIndex = divisions.indexOf(currentDivision) + 1;
                if (nextDivisionIndex < divisions.length) {
                    currentDivision = divisions[nextDivisionIndex];
                    document.getElementById('division').textContent = `Division: ${currentDivision}`;
                }
            }
            updateSchedule();
        }

        function determineNextDivision() {
            if (currentStars >= 4) return "D1";
            if (currentStars === 3) return "D2";
            return "D3";
        }

        function updateSchedule() {
            document.getElementById('schedule').textContent = `Schedule: Race ${totalRaces % racesPerDivision + 1}`;
            if (currentDivision !== "High School") {
                const seasonRaceNumber = (totalRaces % (racesPerDivision * seasonsPerDivision)) % racesPerDivision + 1;
                document.getElementById('schedule').textContent += ` (Season ${currentSeason}, Race ${seasonRaceNumber})`;
                if (seasonRaceNumber === 1) {
                    seasonsRemaining--;
                    if (seasonsRemaining === 0) {
                        currentSeason++;
                        if (currentSeason > seasonsPerDivision) {
                            currentSeason = 1;
                            seasonsRemaining = seasonsPerDivision;
                            checkDivision();
                        }
                    }
                    document.getElementById('seasons-remaining').textContent = `Seasons Remaining: ${seasonsRemaining}`;
                }
            }
        }

        function updateAveragePlacing() {
            let avgPlacing;
            if (currentDivision === "High School" || ["D1", "D2", "D3"].includes(currentDivision)) {
                avgPlacing = (totalPlacing / totalRaces).toFixed(1);
            } else {
                avgPlacing = 0;
            }
            document.getElementById('average-placing').textContent = `Average Placing: ${ordinal(Math.round(avgPlacing))}`;
        }

        function updateBankBalance() {
            if (currentDivision === "High School") {
                document.getElementById('bank-balance').textContent = `Bank Balance: Ineligible`;
            } else {
                document.getElementById('bank-balance').textContent = `Bank Balance: $${bankBalance}`;
            }
        }
    </script>
</body>
</html>
